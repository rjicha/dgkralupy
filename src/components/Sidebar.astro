---
import { getEntry } from 'astro:content';

interface Props {
  currentSection: string;
  currentSlug: string;
}

const { currentSection, currentSlug } = Astro.props;

// Get navigation data
const navigationData = await getEntry('navigation', 'navigation');
const navigationSections = navigationData?.data.sections ?? [];

// Find the current section data
const sectionData = navigationSections.find(section => {
  // Match by section ID or URL path
  const urlPath = section.url.replace(/^\//, '');
  return section.id === currentSection || urlPath === currentSection;
});

// Map section slugs to IDs
const sectionMap: Record<string, string> = {
  'o-skole': 'about',
  'studium': 'studies',
  'aktivity': 'activities',
  'aktualne': 'news',
  'pomoc-jinym': 'help',
  'kontakty': 'contacts',
};

// Try alternate lookup if not found
const finalSectionData = sectionData || navigationSections.find(section =>
  section.id === sectionMap[currentSection]
);
---

{finalSectionData && finalSectionData.subsections && (
  <aside class="w-80 flex-shrink-0">
    <nav class="sticky top-4">
      <div class="bg-bg-content border border-border-light p-6">
        <!-- Section title -->
        <h2 class="text-xl font-heading font-thin uppercase mb-4 text-text-primary">
          <a
            href={import.meta.env.BASE_URL + finalSectionData.url}
            class="hover:text-accent-rose transition-colors"
          >
            {finalSectionData.title}
          </a>
        </h2>

        <!-- Subsections -->
        <ul class="space-y-3">
          {finalSectionData.subsections.map((subsection) => {
            const subsectionSlug = subsection.url.replace(/^\//, '');
            const isActive = currentSlug === subsectionSlug;

            return (
              <li>
                <a
                  href={import.meta.env.BASE_URL + subsection.url}
                  class={`block px-4 py-3 text-sm font-normal transition-colors ${
                    isActive
                      ? 'text-accent-rose bg-accent-rose/5 border-l-4 border-accent-rose'
                      : 'text-text-primary hover:text-accent-rose border-l-4 border-transparent hover:border-accent-rose/30'
                  }`}
                >
                  {subsection.title}
                </a>
              </li>
            );
          })}
        </ul>
      </div>
    </nav>
  </aside>
)}
