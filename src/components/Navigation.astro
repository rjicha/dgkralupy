---
import { getEntry } from 'astro:content';

// Get navigation data from Content Collections
const navigationData = await getEntry('navigation', 'navigation');
const navigationSections = navigationData?.data.sections ?? [];

// Map color strings to Tailwind classes
const colorMap: Record<string, string> = {
  'primary': 'bg-primary hover:bg-primary/90',
  'primary-dark': 'bg-primary-dark hover:bg-primary-dark/90',
  'secondary': 'bg-secondary hover:bg-secondary/90',
  'accent-green': 'bg-accent-green hover:bg-accent-green/90',
  'accent-coral': 'bg-accent-coral hover:bg-accent-coral/90',
  'accent-rose': 'bg-accent-rose hover:bg-accent-rose/90',
};
---

<nav class="bg-primary-dark text-white">
  <div class="container mx-auto px-4">
    <!-- Desktop Navigation -->
    <ul class="hidden lg:flex">
      {navigationSections.map((section) => (
        <li class="relative group flex-1">
          <a
            href={section.url}
            class={`block px-4 py-3 text-center text-lg font-sans font-normal uppercase transition-colors ${colorMap[section.color]}`}
          >
            {section.title}
          </a>

          {section.subsections && section.subsections.length > 0 && (
            <ul class="absolute left-0 top-full w-64 bg-white text-text-primary shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
              {section.subsections.map((subsection) => (
                <li>
                  <a
                    href={subsection.url}
                    class="block px-4 py-3 text-base hover:bg-bg-page transition-colors border-b border-border-light last:border-b-0"
                  >
                    {subsection.title}
                  </a>
                </li>
              ))}
            </ul>
          )}
        </li>
      ))}
    </ul>

    <!-- Mobile Navigation -->
    <div class="lg:hidden">
      <button
        id="mobile-menu-button"
        class="w-full px-4 py-3 text-left text-base font-sans flex items-center justify-between"
        aria-label="Otevřít menu"
        aria-expanded="false"
      >
        <span>Menu</span>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>

      <div id="mobile-menu" class="hidden">
        {navigationSections.map((section) => (
          <div class="border-t border-primary/30">
            <a
              href={section.url}
              class={`block px-4 py-3 text-sm font-sans uppercase ${colorMap[section.color]}`}
            >
              {section.title}
            </a>

            {section.subsections && section.subsections.length > 0 && (
              <ul class="bg-primary-dark/50">
                {section.subsections.map((subsection) => (
                  <li>
                    <a
                      href={subsection.url}
                      class="block px-6 py-2 text-xs hover:bg-primary-dark/70 transition-colors"
                    >
                      {subsection.title}
                    </a>
                  </li>
                ))}
              </ul>
            )}
          </div>
        ))}
      </div>
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle
  const menuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  if (menuButton && mobileMenu) {
    menuButton.addEventListener('click', () => {
      const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';
      menuButton.setAttribute('aria-expanded', String(!isExpanded));
      mobileMenu.classList.toggle('hidden');
    });
  }
</script>
