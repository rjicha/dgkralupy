---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import ArticleCard from '../../components/ArticleCard.astro';

// Get all published articles
const allArticles = await getCollection('articles', ({ data }) => {
  return data.draft !== true;
});

// Sort articles by date (newest first)
const sortedArticles = allArticles.sort((a, b) => {
  const dateA = new Date(a.data.publishedAt.split('.').reverse().join('-'));
  const dateB = new Date(b.data.publishedAt.split('.').reverse().join('-'));
  return dateB.getTime() - dateA.getTime();
});

// Pagination setup (optional for future)
const articlesPerPage = 12;
const totalPages = Math.ceil(sortedArticles.length / articlesPerPage);
const currentPage = 1;
const paginatedArticles = sortedArticles.slice(0, articlesPerPage);
---

<BaseLayout
  title="Aktuality | Dvořákovo gymnázium Kralupy nad Vltavou"
  description="Všechny aktuality a oznámení Dvořákova gymnázia v Kralupech nad Vltavou."
>
  <div class="container mx-auto px-4 py-8">
    <!-- Breadcrumbs -->
    <nav class="mb-6 text-sm">
      <ol class="flex items-center gap-2 text-text-muted">
        <li><a href={import.meta.env.BASE_URL + "/"} class="hover:text-accent-rose transition-colors">Domů</a></li>
        <li>/</li>
        <li class="text-text-primary">Aktuality</li>
      </ol>
    </nav>

    <!-- Page Header -->
    <header class="mb-8">
      <h1 class="text-4xl font-heading font-thin uppercase text-text-primary border-b-2 border-accent-coral pb-4 mb-4">
        Aktuality
      </h1>
      <p class="text-text-secondary">
        Nejnovější zprávy a oznámení z naší školy. Sledujte zde aktuální dění, připravované akce a důležité informace.
      </p>
    </header>

    <!-- Articles Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
      {paginatedArticles.map((article) => (
        <ArticleCard article={article.data} slug={article.slug} />
      ))}
    </div>

    <!-- Pagination (placeholder for future implementation) -->
    {totalPages > 1 && (
      <nav class="flex justify-center items-center gap-2 mt-12" aria-label="Stránkování">
        <button
          disabled={currentPage === 1}
          class="px-4 py-2 border border-border-light bg-bg-content text-text-muted disabled:opacity-50 disabled:cursor-not-allowed hover:bg-bg-page transition-colors"
        >
          ← Předchozí
        </button>

        <div class="flex gap-2">
          {Array.from({ length: totalPages }, (_, i) => i + 1).map((page) => (
            <a
              href={import.meta.env.BASE_URL + (page === 1 ? '/aktualne' : `/aktualne/page/${page}`)}
              class={`px-4 py-2 border transition-colors ${
                page === currentPage
                  ? 'bg-accent-rose text-white border-accent-rose'
                  : 'border-border-light bg-bg-content text-text-primary hover:bg-bg-page'
              }`}
            >
              {page}
            </a>
          ))}
        </div>

        <button
          disabled={currentPage === totalPages}
          class="px-4 py-2 border border-border-light bg-bg-content text-text-muted disabled:opacity-50 disabled:cursor-not-allowed hover:bg-bg-page transition-colors"
        >
          Další →
        </button>
      </nav>
    )}

    <!-- Tags Cloud -->
    <aside class="mt-12 p-6 bg-bg-content border border-border-light">
      <h2 class="text-xl font-heading font-thin uppercase mb-4 text-text-primary">
        Kategorie
      </h2>
      <div class="flex flex-wrap gap-2">
        {Array.from(new Set(allArticles.flatMap(a => a.data.tags))).map((tag) => (
          <span class="px-3 py-1 text-sm bg-bg-page text-text-secondary border border-border-light">
            {tag}
          </span>
        ))}
      </div>
    </aside>
  </div>
</BaseLayout>
