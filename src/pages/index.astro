---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import ArticleCard from '../components/ArticleCard.astro';
import QuickLinks from '../components/QuickLinks.astro';
import Sponsors from '../components/Sponsors.astro';

// Get all published articles
const allArticles = await getCollection('articles', ({ data }) => {
  return data.draft !== true;
});

// Sort by date (newest first)
const sortedArticles = allArticles.sort((a, b) => {
  const dateA = new Date(a.data.publishedAt.split('.').reverse().join('-'));
  const dateB = new Date(b.data.publishedAt.split('.').reverse().join('-'));
  return dateB.getTime() - dateA.getTime();
});

// Get featured articles and regular articles
const featuredArticles = sortedArticles.filter(article => article.data.featured);
const regularArticles = sortedArticles.filter(article => !article.data.featured);
const heroArticle = featuredArticles.find(article => article.data.important) || featuredArticles[0];
---

<BaseLayout
  title="Dvořákovo gymnázium Kralupy nad Vltavou"
  description="Oficiální webové stránky Dvořákova gymnázia v Kralupech nad Vltavou. Aktuální informace o škole, studiu, aktivitách a akcích."
>
  <!-- Hero Section -->
  {heroArticle && <Hero article={heroArticle.data} slug={heroArticle.slug} />}

  <!-- Main Content -->
  <div class="container mx-auto px-4 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Main Column -->
      <div class="lg:col-span-2">
        <!-- Important News Section -->
        {featuredArticles.length > 0 && (
          <section class="mb-8">
            <h2 class="text-3xl font-heading font-thin uppercase mb-6 text-text-primary border-b-2 border-accent-coral pb-2">
              Důležité zprávy
            </h2>
            <div class="grid grid-cols-1 gap-6">
              {featuredArticles.filter(article => article !== heroArticle).map((article) => (
                <ArticleCard article={article.data} slug={article.slug} featured={true} />
              ))}
            </div>
          </section>
        )}

        <!-- Recent News Section -->
        <section>
          <h2 class="text-3xl font-heading font-thin uppercase mb-6 text-text-primary border-b-2 border-secondary pb-2">
            Aktuálně
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {regularArticles.map((article) => (
              <ArticleCard article={article.data} slug={article.slug} />
            ))}
          </div>

          <!-- View All Link -->
          <div class="mt-8 text-center">
            <a
              href={import.meta.env.BASE_URL + "/aktualne"}
              class="inline-flex items-center gap-2 bg-secondary hover:bg-secondary/90 text-white px-6 py-3 text-base font-normal uppercase transition-colors"
            >
              Zobrazit všechny aktuality
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </a>
          </div>
        </section>
      </div>

      <!-- Sidebar -->
      <aside class="space-y-6">
        <!-- Quick Links -->
        <QuickLinks />

        <!-- Upcoming Events Widget -->
        <div class="bg-bg-content border border-border-light p-6">
          <h2 class="text-xl font-heading font-thin uppercase mb-4 text-text-primary">Nadcházející akce</h2>
          <div class="space-y-4">
            <div class="border-l-4 border-accent-coral pl-3">
              <p class="text-sm font-normal text-text-primary">Den otevřených dveří</p>
              <p class="text-xs text-text-muted">3. prosince 2025, 14:30-17:00</p>
            </div>
            <div class="border-l-4 border-accent-green pl-3">
              <p class="text-sm font-normal text-text-primary">Vánoční koncert</p>
              <p class="text-xs text-text-muted">18. prosince 2025</p>
            </div>
            <div class="border-l-4 border-secondary pl-3">
              <p class="text-sm font-normal text-text-primary">Pololetní prázdniny</p>
              <p class="text-xs text-text-muted">31. ledna 2026</p>
            </div>
          </div>
        </div>

        <!-- Info Box -->
        <div class="bg-accent-green/10 border border-accent-green/30 p-6">
          <h3 class="text-lg font-heading font-thin uppercase mb-3 text-text-primary">Pro uchazeče</h3>
          <p class="text-sm text-text-secondary mb-4">
            Zvažujete studium na našem gymnáziu? Navštivte naši sekci pro uchazeče!
          </p>
          <a
            href={import.meta.env.BASE_URL + "/studium/prijimaci-rizeni"}
            class="inline-block bg-accent-rose hover:bg-accent-rose/90 text-white px-4 py-2 text-sm uppercase transition-colors"
          >
            Přijímací řízení
          </a>
        </div>

        <!-- Sponsors -->
        <Sponsors />
      </aside>
    </div>
  </div>
</BaseLayout>
