---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Sidebar from '../components/Sidebar.astro';

export async function getStaticPaths() {
  const pages = await getCollection('pages', ({ data }) => {
    return data.draft !== true;
  });

  return pages.map((page) => ({
    params: { slug: page.slug },
    props: { page },
  }));
}

const { page } = Astro.props;
const { Content } = await page.render();

// Section mapping for proper breadcrumb titles
const sectionMap: Record<string, { title: string; url: string }> = {
  'o-skole': { title: 'O škole', url: '/o-skole' },
  'studium': { title: 'Studium', url: '/studium' },
  'aktivity': { title: 'Aktivity', url: '/aktivity' },
  'kontakty': { title: 'Kontakty', url: '/kontakty' },
  'pomoc-jinym': { title: 'Pomoc jiným', url: '/pomoc-jinym' },
};
---

<BaseLayout
  title={`${page.data.title} | Dvořákovo gymnázium Kralupy nad Vltavou`}
  description={page.data.description || page.data.title}
>
  <div class="container mx-auto px-4 py-8">
    <div class="flex gap-8">
      <!-- Sidebar Navigation -->
      {page.data.section && (
        <Sidebar currentSection={page.data.section} currentSlug={page.slug} />
      )}

      <!-- Main Content -->
      <article class="flex-1 min-w-0 max-w-4xl">
        <!-- Breadcrumb -->
        <nav class="text-sm text-text-muted mb-6">
          <ol class="flex items-center gap-2">
            <li><a href={import.meta.env.BASE_URL + "/"} class="hover:text-accent-rose">Úvod</a></li>
            {page.data.section && sectionMap[page.data.section] && (
              <>
                <li>/</li>
                <li>
                  <a
                    href={import.meta.env.BASE_URL + sectionMap[page.data.section].url}
                    class="hover:text-accent-rose"
                  >
                    {sectionMap[page.data.section].title}
                  </a>
                </li>
              </>
            )}
            <li>/</li>
            <li class="text-text-primary">{page.data.title}</li>
          </ol>
        </nav>

        <!-- Page Header -->
        <header class="mb-8">
          <h1 class="text-4xl md:text-5xl font-heading font-thin uppercase text-text-primary border-b-2 border-accent-coral pb-4">
            {page.data.title}
          </h1>

          <!-- Author metadata (if present) -->
          {page.data.author && (
            <div class="flex items-center gap-2 mt-4 text-text-muted">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              <span class="text-sm uppercase">{page.data.author}</span>
            </div>
          )}
        </header>

        <!-- Page Content -->
        <div class="prose max-w-none">
          <Content />
        </div>
      </article>
    </div>
  </div>
</BaseLayout>
